syntax = "proto2";

package transferLearning;

/*
 Represents a single stage of transfer learning, in which we initialize weights
 and learning rates from some pre-defined set of weights (or not) and learn on
 a new dataset.
*/

// FIELDS
// For each stage (they're in a list):
message Stage {
    required string name = 1;
    
    // TODO the dataset used to learn in this stage
    // optional string dataset = ;
    // TODO a partial model file to be integrated into the main file
    // optional string partialModel = ;

    message CommandSolver {
        required string command = 1;
        // Needed to make ignore layers work
        optional string in_model_filename = 2;
    }

    // Choose the type of solver used in this stage.
    required string solver_filename = 2;
    // Provide only one of the two.
    optional CommandSolver cmd_solver = 3;
    
    // Specifies layers to freeze during training, as a list
    repeated string freeze = 4;
    // Specifies layers to reinitialize with random values
    repeated string ignore = 5;
}

// Defines a whole transfer learning cycle
message TransferLearning {
    repeated Stage stage = 2;
    repeated MultiSource multiSource = 3;
}

message MultiSource {
    optional int32 iterations = 1 [default = 1];
    repeated Stage stage = 2;
    enum MetricType {
        ACCURACY = 0;
        ERROR = 1;
        MEAN_IU = 2;
    }
    optional MetricType scoreMetric = 3 [default = MEAN_IU];
}